% -*- coding: utf-8 -*-
% Сборка приложения во~множественных мирах
\begin{tikzpicture}
  \tikzstyle{every node}=[font=\small]

\input{figures/fig9.macros}

\def\caption#1{%
  \node [anchor = south west] at(0.5em, 2.25em) {\emph{#1}};
}

\begin{scope}[yshift = +7.5em]
  \caption{si/libexp.scm}
\begin{scope}[xshift = +10.25em]
  \framenode{+10.25em}{2.25em} {\begin{code:lisp}
(define (fact2 ...) ...)

(define-abbreviation (factorial ...) ...)
  \end{code:lisp}};
\begin{scope}[xshift = +10.25em]
  \draw (0.25em, 0.0em) -- (2.30em, 0.0em);
\begin{scope}[xshift = 2.35em]
  \begin{scope}[xshift = 1.95em]
    \binaryright{prepare}{3.0em}
  \end{scope}
\begin{scope}[xshift = 4.5em]
  \draw [->] (0.0em, 0.0em) -- (2.5em, 0.0em);
\begin{scope}[xshift = 2.75em]
  \begin{scope}[xshift = 2.25em]
    \binarydown{libexp}{3.0em}
  \end{scope}
\end{scope}\end{scope}\end{scope}\end{scope}
\end{scope}\end{scope}


\begin{scope}[yshift = 0.0em]
  \caption{si/librun.scm}
\begin{scope}[xshift = +6.125em]
  \framenode{+6.125em}{2.25em} {\begin{code:lisp}
(define (fact1 ...) ...)
  \end{code:lisp}};
\begin{scope}[xshift = 6.125em]
  \draw (0.25em, 0.0em) -- (2.30em, 0.0em);
\begin{scope}[xshift = 2.35em]
  \begin{scope}[xshift = 1.95em]
    \binaryright{prepare}{3.0em}
  \end{scope}
\begin{scope}[xshift = 4.5em]
  \draw [->] (0.0em, 0.0em) -- (2.5em, 0.0em);
\begin{scope}[xshift = 2.75em]
  \begin{scope}[xshift = 2.25em]
    \binaryup{librun}{3.0em}
  \end{scope}
\end{scope}\end{scope}\end{scope}\end{scope}
\end{scope}\end{scope}

\begin{scope}[yshift = -7.5em]
  \caption{si/chap9d.scm}
\begin{scope}[xshift = +7.375em]
  \framenode{+7.375em}{2.25em} {\begin{code:lisp}
(define (some-facts ...) ...)
  \end{code:lisp}};
\begin{scope}[xshift = 7.375em]
  \draw (0.25em, 0.0em) -- (3.00em, 0.0em);
\begin{scope}[xshift = 1.50em]
  \begin{scope}[xshift = 3.00em]
    \binarydouble{prepare}{libexp}{3.0em}
  \end{scope}
\begin{scope}[xshift = 4.5em]
  \draw [->] (0.0em, 0.0em) -- (2.5em, 0.0em);
\begin{scope}[xshift = 2.75em]
  \begin{scope}[xshift = 2.25em]
    \binarydown{prog}{3.0em}
  \end{scope}
\end{scope}\end{scope}\end{scope}\end{scope}
\end{scope}\end{scope}

\begin{scope}[xshift = 32.375em, yshift = -2.50em]
  \binarydouble{librun}{prog}{3.0em}
  \node [below] at(0.0em, -4.65em) {\emph{приложение}};
\end{scope}

\end{tikzpicture}
